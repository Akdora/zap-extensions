<project name="ZAP-Extensions" default="build-all" basedir=".">
	<description>Build ZAP extensions</description>

	<property name="src" location="../src" />
	<property name="build" location="build" />
	<property name="dist" location="zap-exts" />
	<property name="dist.lib.dir" location="../lib" />
	<!-- This assumes you also have the zaproxy project -->
	<property name="zap.plugin.dir" location="../../zaproxy/src/plugin" />

	<target name="clean">
		<delete dir="${dist}" includeEmptyDirs="true" />
		<delete dir="${build}" includeEmptyDirs="true" />
	</target>

	<target name="init">
		<!-- Create the build directory structure used by compile -->
		<mkdir dir="${dist}" />
		<mkdir dir="${build}" />
	</target>

	<target name="compile" depends="init" description="compile the source">
		<echo message="Compiling the source..." />
		<!-- Compile the java code from ${src} into ${build} -->
		<!--javac srcdir="${src}" destdir="${build}" classpath="zap.jar"/-->
		<javac srcdir="${src}" destdir="${build}">
			<classpath>
				<fileset dir="${dist.lib.dir}">
					<include name="**/*.jar" />
				</fileset>
			</classpath>
		</javac>
	</target>

	<!-- Active scanner -->
	<target name="build-exampleActiveScan" depends="compile" description="build the exampleActiveScan extension">
		<jar jarfile="${dist}/zap-ext-exampleActiveScan.jar" update="true" compress="false">
			<zipfileset dir="${build}" prefix="">
				<include name="org/zaproxy/zap/extension/exampleActiveScan/**"/>
			</zipfileset>
			<zipfileset dir="${src}" prefix="">
				<include name="org/zaproxy/zap/extension/exampleActiveScan/Messages*"/>
			</zipfileset>
		</jar>
	</target>

	<target name="deploy-exampleActiveScan" depends="build-exampleActiveScan" description="deploy the exampleActiveScan extension">
		<!-- Active scan rules go in the plugin directory-->
		<copy file="${dist}/zap-ext-exampleActiveScan.jar" toDir="${zap.plugin.dir}" overwrite="true" />
	</target>

	<!-- Example Passive scanner -->
	<target name="build-examplePassiveScan" depends="compile" description="build the examplePassiveScan extension">
		<jar jarfile="${dist}/zap-ext-examplePassiveScan.jar" update="true" compress="false">
			<zipfileset dir="${build}" prefix="">
				<include name="org/zaproxy/zap/extension/examplePassiveScan/**"/>
			</zipfileset>
			<zipfileset dir="${src}" prefix="">
				<include name="org/zaproxy/zap/extension/examplePassiveScan/Messages*"/>
			</zipfileset>
		</jar>
	</target>

	<target name="deploy-examplePassiveScan" depends="build-examplePassiveScan" description="deploy the examplePassiveScan extension">
		<copy file="${dist}/zap-ext-examplePassiveScan.jar" toDir="${zap.plugin.dir}" overwrite="true" />
	</target>

	<!-- Example Passive scanner -->
	<target name="build-viewStatePScan" depends="compile" description="build the viewStatePScan extension">
		<jar jarfile="${dist}/zap-ext-viewStatePScan.jar" update="true" compress="false">
			<zipfileset dir="${build}" prefix="">
				<include name="org/zaproxy/zap/extension/viewStatePScan/**"/>
			</zipfileset>
			<!--zipfileset dir="${src}" prefix="">
				<include name="org/zaproxy/zap/extension/viewStatePScan/Messages*"/>
			</zipfileset-->
		</jar>
	</target>

	<target name="deploy-viewStatePScan" depends="build-viewStatePScan" description="deploy the viewStatePScan extension">
		<copy file="${dist}/zap-ext-viewStatePScan.jar" toDir="${zap.plugin.dir}" overwrite="true" />
	</target>

	<!-- Extension: example right click message menu -->
	<target name="build-exampleRightClickMsg" depends="compile" description="build the exampleRightClickMsg extension">
		<jar jarfile="${dist}/zap-ext-exampleRightClickMsg.jar" update="true" compress="false">
			<zipfileset dir="${build}" prefix="">
				<include name="org/zaproxy/zap/extension/exampleRightClickMsg/**"/>
			</zipfileset>
			<zipfileset dir="${src}" prefix="">
				<include name="org/zaproxy/zap/extension/exampleRightClickMsg/Messages*"/>
			</zipfileset>
		</jar>
	</target>

	<target name="deploy-exampleRightClickMsg" depends="build-exampleRightClickMsg" description="deploy the exampleRightClickMsg extension">
		<copy file="${dist}/zap-ext-exampleRightClickMsg.jar" toDir="${zap.plugin.dir}" overwrite="true" />
	</target>

	<!-- Extension: example top level menu -->
	<target name="build-exampleTopMenu" depends="compile" description="build the exampleTopMenu extension">
		<jar jarfile="${dist}/zap-ext-exampleTopMenu.jar" update="true" compress="false">
			<zipfileset dir="${build}" prefix="">
				<include name="org/zaproxy/zap/extension/exampleTopMenu/**"/>
			</zipfileset>
			<zipfileset dir="${src}" prefix="">
				<include name="org/zaproxy/zap/extension/exampleTopMenu/Messages*"/>
			</zipfileset>
		</jar>
	</target>

	<target name="deploy-exampleTopMenu" depends="build-exampleTopMenu" description="deploy the exampleTopMenu extension">
		<copy file="${dist}/zap-ext-exampleTopMenu.jar" toDir="${zap.plugin.dir}" overwrite="true" />
	</target>

	<target name="build-all" depends="clean,compile" description="build all of the extensions">
		<antcall target="build-exampleActiveScan" />
		<antcall target="build-examplePassiveScan" />
		<antcall target="build-exampleRightClickMsg" />
		<antcall target="build-exampleTopMenu" />
		<antcall target="build-viewStatePScan" />
	</target>

	<target name="deploy-all" depends="build-all" description="build all of the extensions">
		<antcall target="deploy-exampleActiveScan" />
		<antcall target="deploy-examplePassiveScan" />
		<antcall target="deploy-exampleRightClickMsg" />
		<antcall target="deploy-exampleTopMenu" />
		<antcall target="deploy-viewStatePScan" />
	</target>


</project>