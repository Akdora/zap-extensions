<html>
<head>
<title>{{MSG.TITLE}}</title>
<style type="text/css">
a.button {
    text-decoration: none;
    background-color: #EEEEEE;
    color: #333333;
    padding: 2px 6px 2px 6px;
    border-top: 1px solid #CCCCCC;
    border-right: 1px solid #333333;
    border-bottom: 1px solid #333333;
    border-left: 1px solid #CCCCCC;
}
</style>
</head>
<body>
<script type="application/javascript">
<!--
function install (aEvent)
{
  for (var a = aEvent.target; a.href === undefined;) a = a.parentNode;
  var params = {
    "Foo": { URL: aEvent.target.href,
             IconURL: aEvent.target.getAttribute("iconURL"),
             Hash: aEvent.target.getAttribute("hash"),
             toString: function () { return this.URL; }
    }
  };
  InstallTrigger.install(params);

  return false;
}
-->
</script>
	<h1>{{MSG.HEADER}}</h1>
	<p>{{MSG.INTRO1}}</p>
	<p></p>
	<p>{{MSG.INTRO2}}</p>
	<p>

    <div id="setup" style="display:none">
      <p>{{MSG.SETUP1}}</p>
      <p>
      	{{MSG.SETUP2}}
      	
      	<b><a class="button" href="{{ROOT}}/OTHER/mitm/other/ringleader.xpi"
    hash="sha1:8aa542520c49c8f2749188274e4cc0adc7f2e811"
  onclick="return install(event);">{{MSG.FIREFOX}}</a></b>
      	
      	<!--
	  	<b><a href="{{ROOT}}/OTHER/mitm/other/ringleader.xpi">{{ROOT}}/OTHER/mitm/other/ringleader.xpi</a></b>
	  	-->
	  </p>
	</div>
    <div id="in_progress" style="display:none">
      <p>{{MSG.PROGRESS}}</p>
    </div>
    <div id="success" style="display:none">
      <p>{{MSG.SUCCESS}}</p>
    </div>
    <div id="failure" style="display:none">
      <p>{{MSG.FAILURE}}</p>
    </div>
    <div id="activated" style="display:none">
      <p>{{MSG.ACTIVATED}}</p>
    </div>
    <div id="actions">
      <p>
      <button id="btn">{{MSG.BUTTON}}</button>
      </p>
  	</div>
  </p>
</body>
<script>
  var detected = false;
  var divs = ['setup','in_progress','success','failure','activated','actions'];
  var manifest = {"detail":{"url":"{{ROOT}}/manifest"}};
  // only show UI for the named elements
  var showUI = function(visible){
    for(var idx in divs){
      if (-1 != visible.indexOf(divs[idx])) {
        document.getElementById(divs[idx]).style.display = 'inline';
        } else {
        document.getElementById(divs[idx]).style.display = 'none';
      }
    }
  };
  // event listener for button press
  var click = function(event) {
    var evt = new CustomEvent('ConfigureSecProxy', manifest);
    document.dispatchEvent(evt);
    setTimeout(function() {
      if (!detected) {
        showUI(['setup']);
     }
    },1000);
  };
  // event listener for configuration started event
  var started = function(event) {
    console.log('configuration has started');
    showUI(['in_progress']);
    detected = true;
  };
  // event listener for configuration failed event
  // use this to let the user know something has gone wrong
  var failed = function(event) {
    console.log('configuration has failed');
    showUI(['failure','actions']);
  };
  // event listener for configuration succeeded
  // use this to show a success message to a user in your welcome doc
  var succeeded = function(event) {
    console.log('configuration has succeeded');
    showUI(['success']);
  };
  // event listener for browser support activated
  var activated = function(event) {
    console.log('activation has occurred');
    showUI(['activated','actions']);
  };
  // hook event listener into button
  var btn = document.getElementById('btn');
  btn.addEventListener('click',click,false);
  // Hook configuration event listeners into the document
  document.addEventListener('ConfigureSecProxyStarted',started,false);
  document.addEventListener('ConfigureSecProxyFailed',failed,false);
  document.addEventListener('ConfigureSecProxyActivated',activated,false);
  document.addEventListener('ConfigureSecProxySucceeded',succeeded,false);
</script>
</html>
